-- Create the database
CREATE DATABASE IF NOT EXISTS `nwr_crdb` 
  DEFAULT CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;

USE `nwr_crdb`;

-- Create the users table
CREATE TABLE `users` (
  `userid` INT(10) NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(100) NOT NULL,
  `email` VARCHAR(200) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `role` ENUM('admin', 'viewer', 'manager') NOT NULL DEFAULT 'viewer',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`userid`),
  UNIQUE KEY `username_unique` (`username`),
  UNIQUE KEY `email_unique` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Create the contracts table
CREATE TABLE `contracts` (
  `contractid` INT(10) NOT NULL AUTO_INCREMENT,
  `parties` VARCHAR(255) NOT NULL,
  `typeOfContract` VARCHAR(150) NOT NULL,
  `duration` VARCHAR(100) NOT NULL,
  `description` TEXT,
  `expiryDate` DATE NOT NULL,
  `reviewByDate` DATE NULL,
  `contractValue` DECIMAL(15,2) NULL,
  `filepath` VARCHAR(255) NULL,
  `manager_id` INT(10) NOT NULL, -- Foreign key referencing the manager
  PRIMARY KEY (`contractid`),
  FOREIGN KEY (`manager_id`) REFERENCES `users`(`userid`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;



-- Insert sample contracts with correct manager_id 
INSERT INTO `contracts` 
(`parties`, `typeOfContract`, `duration`, `description`, `expiryDate`, `reviewByDate`, `contractValue`, `manager_id`)
VALUES
('NWR // NBC', 'Barter agreement', '2 years', NULL, '2024-10-31', '2024-09-01', 78499.00, 2),
('NWR // Microsoft', 'Office 365', '12 months', NULL, '2024-11-01', NULL, NULL, 2),
('NWR // FNB', 'Credit OD Facility', 'One-year', NULL, '2024-12-31', '2024-11-01', 6500000.00, 2),
('NWR // CIMSO', 'ERP system (Innkeeper)', '12 months', NULL, '2025-07-31', NULL, 87548.66, 2),
('NWR // Alliance Media', 'Lease agreement', '10 years', NULL, '2025-12-31', '2025-10-01', 86940.00, 2),
('NWR // Ricoh', 'Printers rental', '36 months', NULL, '2026-03-31', NULL, NULL, 2),
('NWR // Microsoft', 'Volume licensing', '36 months', NULL, '2026-03-31', NULL, NULL, 2),
('NWR // BCX', 'Offsite backup of data', '12 months', NULL, '2026-08-01', NULL, NULL, 2);

CREATE TABLE contract_types (
  typeid INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(150) NOT NULL UNIQUE,
  created_by INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (created_by) REFERENCES users(userid) ON DELETE SET NULL
);


INSERT INTO contractTypes (name, createdBy)
VALUES
('Service Agreement', NULL),
('Supply Agreement', NULL),
('Employment Contract', NULL),
('Lease Agreement', NULL),
('Partnership Agreement', NULL),
('Other', NULL);


Cardinality Summary

One-to-Many: One manager can create multiple contracts, but each contract is created by exactly one manager.

Many-to-Many (Access): All users can view all contracts, but no direct relationship in the database schema is needed for this access as it will be handled by the application logic.

Manager Notification: The manager linked to each contract via manager_id should be notified about the contract's expiry.
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NWR Contract Registry - Login Test Results</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f7fa; 
        }
        .test-container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }
        .status-good { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
        .test-section { 
            margin: 25px 0; 
            padding: 20px; 
            border-left: 4px solid #0758aa; 
            background: #f8f9fa; 
        }
        .login-form {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .btn-test {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn-test:hover {
            background: #0056b3;
        }
        .result-box {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîê NWR Contract Registry - Login Test Dashboard</h1>
        <p><strong>Date:</strong> <span id="current-date"></span></p>
        <p><strong>Environment:</strong> Production (LDAP Authentication)</p>

        <div class="test-section">
            <h2>üìä System Status</h2>
            <div>
                <span class="status-good">‚úÖ LDAP Connection: Working</span><br>
                <span class="status-good">‚úÖ PHP LDAP Extension: Loaded</span><br>
                <span class="status-good">‚úÖ Web API: Functional</span><br>
                <span class="status-good">‚úÖ Database: Connected</span><br>
                <span class="status-warning">‚ö†Ô∏è Login Tests: Awaiting real credentials</span>
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Manual Login Test</h2>
            <p>Test the LDAP authentication with your hell.lab domain credentials:</p>
            
            <div class="login-form">
                <form id="test-login-form">
                    <div class="form-group">
                        <label for="test-username">Username or Email:</label>
                        <input type="text" id="test-username" name="username" 
                               placeholder="username or username@hell.lab" required>
                        <small>Try both formats: 'username' or 'username@hell.lab'</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="test-password">Password:</label>
                        <input type="password" id="test-password" name="password" 
                               placeholder="Your domain password" required>
                    </div>
                    
                    <button type="submit" class="btn-test">üîê Test Login</button>
                    <button type="button" class="btn-test" onclick="clearResults()">üîÑ Clear</button>
                </form>
                
                <div id="test-result" class="result-box">
                    <div id="test-result-content"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üéØ Test Scenarios</h2>
            <h3>Recommended Test Cases:</h3>
            <ol>
                <li><strong>Administrator Account</strong>
                    <ul>
                        <li>Username: administrator</li>
                        <li>Expected Role: admin (if in NWR-Admins group)</li>
                    </ul>
                </li>
                <li><strong>Manager Account</strong>
                    <ul>
                        <li>Username: [manager-username]</li>
                        <li>Expected Role: manager (if in NWR-Managers group)</li>
                    </ul>
                </li>
                <li><strong>Regular User</strong>
                    <ul>
                        <li>Username: [regular-username]</li>
                        <li>Expected Role: viewer (default role)</li>
                    </ul>
                </li>
                <li><strong>Email Format Test</strong>
                    <ul>
                        <li>Email: username@hell.lab</li>
                        <li>Should work the same as username only</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="test-section">
            <h2>üìã Expected Behavior</h2>
            <h3>Successful Login:</h3>
            <ul>
                <li>‚úÖ User authenticates against hell.lab Active Directory</li>
                <li>‚úÖ User is automatically created/updated in local database</li>
                <li>‚úÖ Role is assigned based on LDAP group membership</li>
                <li>‚úÖ User is redirected to dashboard</li>
                <li>‚úÖ Session is created for continued access</li>
            </ul>
            
            <h3>Failed Login:</h3>
            <ul>
                <li>‚ùå Invalid credentials message</li>
                <li>‚ùå User remains on login page</li>
                <li>‚ùå No session created</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>üîß Configuration Details</h2>
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Setting</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Value</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">LDAP Server</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">ldap://localhost:389</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Domain</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">hell.lab</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Base DN</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">DC=hell,DC=lab</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Environment</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Production</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Auto User Creation</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Enabled</td>
                </tr>
            </table>
        </div>

        <div class="test-section">
            <h2>üåê Application Links</h2>
            <a href="http://localhost/nwrcontractregistry/frontend/index.php" target="_blank" class="btn-test">
                üöÄ Open Login Page
            </a>
            <a href="http://localhost/nwrcontractregistry/frontend/pages/dashboard.html" target="_blank" class="btn-test">
                üìä Dashboard (requires login)
            </a>
        </div>
    </div>

    <script>
        // Set current date
        document.getElementById('current-date').textContent = new Date().toLocaleString();

        // Handle test login form
        document.getElementById('test-login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('test-username').value;
            const password = document.getElementById('test-password').value;
            const resultBox = document.getElementById('test-result');
            const resultContent = document.getElementById('test-result-content');
            
            if (!username || !password) {
                showResult('Please enter both username and password', false);
                return;
            }
            
            // Show loading
            showResult('Testing login... Please wait.', null);
            
            try {
                const formData = new FormData();
                formData.append('email', username);
                formData.append('password', password);
                
                const response = await fetch('/nwrcontractregistry/backend/auth_handler.php?action=login', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(`
                        <strong>‚úÖ LOGIN SUCCESSFUL!</strong><br>
                        Username: ${result.user.username || 'Unknown'}<br>
                        Role: ${result.user.role || 'Unknown'}<br>
                        Method: ${result.method || 'Unknown'}<br>
                        User ID: ${result.user.id || 'Unknown'}<br>
                        <br>
                        <em>User has been automatically created/updated in database and session established.</em>
                    `, true);
                } else {
                    showResult(`
                        <strong>‚ùå LOGIN FAILED</strong><br>
                        Error: ${result.error || 'Unknown error'}<br>
                        <br>
                        <em>Please check username/password and ensure the account exists in hell.lab domain.</em>
                    `, false);
                }
            } catch (error) {
                showResult(`
                    <strong>‚ùå CONNECTION ERROR</strong><br>
                    Error: ${error.message}<br>
                    <br>
                    <em>Could not connect to authentication service.</em>
                `, false);
            }
        });
        
        function showResult(message, isSuccess) {
            const resultBox = document.getElementById('test-result');
            const resultContent = document.getElementById('test-result-content');
            
            resultContent.innerHTML = message;
            
            if (isSuccess === true) {
                resultBox.className = 'result-box result-success';
            } else if (isSuccess === false) {
                resultBox.className = 'result-box result-error';
            } else {
                resultBox.className = 'result-box';
                resultBox.style.background = '#fff3cd';
                resultBox.style.border = '1px solid #ffeaa7';
                resultBox.style.color = '#856404';
            }
            
            resultBox.style.display = 'block';
        }
        
        function clearResults() {
            document.getElementById('test-result').style.display = 'none';
            document.getElementById('test-username').value = '';
            document.getElementById('test-password').value = '';
        }
    </script>
</body>
</html>